                                                     --FIT5195 ASSIGNMENT 1 PART A
                                                     --GOVERNMENT HOSPITAL CASE STUDY
                                                     --MADE BY SOVAN SINHA ROY (STUDENT ID: 30201152)
 
 
--DROP TABLE PATIENT CASCADE CONSTRAINTS;
--DROP TABLE DOCTOR CASCADE CONSTRAINTS;
--DROP TABLE CLINIC CASCADE CONSTRAINTS;
--DROP TABLE SERVICE CASCADE CONSTRAINTS;
--DROP TABLE ASSIGNMENT CASCADE CONSTRAINTS;
--DROP TABLE SERVICEDIM;
--DROP TABLE SERVICECOSTTYPEDIM;
--DROP TABLE HOSPLOCDIM;
--DROP TABLE AGEGROUPDIM;
--DROP TABLE TIMEPERIODDIM;
--DROP TABLE TEMP_FACT_TF;
--DROP TABLE GOVTHOSPFACT;



--TASK 1

CREATE TABLE PATIENT
( patient_id number(4)PRIMARY KEY,
  patient_name varchar(30) NOT NULL,
  patient_age number(3) NOT NULL,
  patient_ph_no number(12),
  patient_address varchar(50),
  patient_nationality varchar(25),
  patient_emergency_contact number(12));
  
  --DESC PATIENT;
  
  INSERT INTO PATIENT VALUES (1001, 'ALEXANDER ARNOLD', 11, 0475050229, '11/4 BRAMALL LANE', 'AUSTRALIAN', 0422561532);
  INSERT INTO PATIENT VALUES (1002, 'ALEX HALES', 91, 0476050228, '14/4 WHITE HART LANE', 'AUSTRALIAN', 0532567542);
  INSERT INTO PATIENT VALUES (1703, 'ALICE SMITH', 23, 0475040129, '11/5 BROOKYLN AVENUE', 'AMERICAN', 0632567536);
  INSERT INTO PATIENT VALUES (1034, 'AMIT SINGH', 14, 0471054226, '11/1 ANFIELD', 'INDIAN', 0432767537);
  INSERT INTO PATIENT VALUES (1003, 'AJAY SHARMA', 61, 0675050229, '11/4 CHAPPEL STREET', 'INDIAN', 0412567511);
  INSERT INTO PATIENT VALUES (1066, 'COREY ANDERSON', 68, 0476757209, '7/4 ST KILDA ROAD', 'AUSTRALIAN', 0442567544);
  INSERT INTO PATIENT VALUES (1057, 'SAM SMITH', 01, 0956142851, '11/4 GANDHI PATH', 'AUSTRALIAN', 0438588538);
  INSERT INTO PATIENT VALUES (1028, 'ALEXANDER WRIGHT', 27, 0135790864, '16/2 VIJAY DWAR', 'AUSTRALIAN', 0632567536);
  INSERT INTO PATIENT VALUES (1019, 'SANJAY MISHRA', 76, 0454433321, '10/5 ANDHERI EAST', 'INDIAN', 0431567531);
  INSERT INTO PATIENT VALUES (1050, 'ANITA RAO', 42, 0971020449, '13/4 BRAMALL LANE', 'AUSTRALIAN', 0932567530);
  
  SELECT * FROM PATIENT ORDER BY PATIENT_ID;
  
  CREATE TABLE DOCTOR
( staff_id number(4)PRIMARY KEY,
  staff_name varchar(30) NOT NULL,
  staff_ph_no number(12));
  
  --DESC DOCTOR;
  
  INSERT INTO DOCTOR VALUES (9001, 'JYOTI SINGH', 0391040512);
  INSERT INTO DOCTOR VALUES (9002, 'AJAY MEHTA', 0194040551);
  INSERT INTO DOCTOR VALUES (9010, 'LI CHANG', 0314041512);
  INSERT INTO DOCTOR VALUES (9011, 'JYOTI SHARMA', 0494040542);
  INSERT INTO DOCTOR VALUES (9004, 'JOHN WRIGHT', 0494040554);
  INSERT INTO DOCTOR VALUES (9006, 'JOHN SMITH', 0394444552);
  INSERT INTO DOCTOR VALUES (9009, 'REBECCA WATSON', 0494044542);
  INSERT INTO DOCTOR VALUES (9008, 'JORDAN SANCHO', 0494440452);
  
  SELECT * FROM DOCTOR ORDER BY STAFF_ID;
  --DROP TABLE DOCTOR;
  
  CREATE TABLE CLINIC
( hospital_id number(3)PRIMARY KEY,
  hospital_name varchar(30) NOT NULL,
  hospital_address varchar(40) NOT NULL,
  suburb varchar(25) NOT NULL,
  postcode number(4) NOT NULL);
  
  INSERT INTO CLINIC VALUES (101, 'APOLLO MAX', '14 BOURKE STREET', 'MELBOURNE', 3079);
  INSERT INTO CLINIC VALUES (102, 'GLOBAL HEART', '60 WAVERLEY ROAD', 'MALVERN EAST', 3145);
  INSERT INTO CLINIC VALUES (103, 'THE ALFRED', '55 COMMERCIAL ROAD', 'ARMADALE', 3044);
  INSERT INTO CLINIC VALUES (119, 'AAMS MELBOURNE', '18 GLEN HUNTLY ROAD', 'GLEN HUNTLY', 3163);
  INSERT INTO CLINIC VALUES (183, 'THE DEN', '1O RACECOURSE ROAD', 'CLAYTON', 3168);
  INSERT INTO CLINIC VALUES (106, 'MONASH HOSPITAL', '59 WAVERLEY ROAD', 'MALVERN EAST', 3145);
    
  SELECT * FROM CLINIC ORDER BY HOSPITAL_ID;
  
  
  CREATE TABLE SERVICE
( service_id number(5)PRIMARY KEY,
  staff_id number(4),
  hospital_id number(3) NOT NULL,
  service_name varchar(30),
  service_cost number(6,2),
  FOREIGN KEY (staff_id) REFERENCES DOCTOR(staff_id),
  FOREIGN KEY (hospital_id) REFERENCES CLINIC(hospital_id));
  
  DESC SERVICE;
  
  INSERT INTO SERVICE VALUES (10001, 9001, 101, 'GENERAL MEDICAL CONSULTATIONS', 10.00);
  INSERT INTO SERVICE VALUES (10002, 9002, 103, 'MENTAL HEALTH', 40.00);
  INSERT INTO SERVICE VALUES (10005, 9006, 119, 'SEXUAL HEALTH', 80.00);
  INSERT INTO SERVICE VALUES (10009, 9002, 102, 'GENERAL PATHOLOGY', 120.00);
  INSERT INTO SERVICE VALUES (10035, 9001, 183, 'PAEDIATRIC HEALTH', 60.00);
  INSERT INTO SERVICE VALUES (10077, 9001, 183, 'WELLNESS SUPPORT', 30.00);
  INSERT INTO SERVICE VALUES (10011, 9002, 106, 'SKIN DISEASES', 75.00);
  INSERT INTO SERVICE VALUES (10010, 9011, 106, 'SPORTS MEDICINE', 150.00);
  
  SELECT * FROM SERVICE ORDER BY SERVICE_ID;
  
   CREATE TABLE ASSIGNMENT
( assignment_id number(4)PRIMARY KEY,
  patient_id number(4),
  patient_service_start_date date NOT NULL,
  patient_service_end_date date NOT NULL,
  service_id number(5),
  FOREIGN KEY (patient_id) REFERENCES PATIENT(patient_id),
  FOREIGN KEY (service_id) REFERENCES SERVICE(service_id));
  
  DESC SERVICE;

 INSERT INTO ASSIGNMENT VALUES (0010, 1001, '24-APR-2020', '25-APR-2020',10001);
 INSERT INTO ASSIGNMENT VALUES (0011, 1002, '21-JAN-2020', '22-JAN-2020',10002);
 INSERT INTO ASSIGNMENT VALUES (0012, 1001, '12-FEB-2020', '14-FEB-2020',10001);
 INSERT INTO ASSIGNMENT VALUES (0015, 1050, '04-APR-2020', '06-APR-2020',10005);
 INSERT INTO ASSIGNMENT VALUES (0017, 1001, '24-JAN-2020', '27-JAN-2020',10009);
 INSERT INTO ASSIGNMENT VALUES (0019, 1057, '24-MAR-2020', '26-MAR-2020',10005);
 INSERT INTO ASSIGNMENT VALUES (0020, 1019, '12-JUL-2020', '19-JUL-2020',10011);
 INSERT INTO ASSIGNMENT VALUES (0022, 1066, '09-MAR-2020', '12-MAR-2020',10077);
 
 SELECT * FROM ASSIGNMENT ORDER BY ASSIGNMENT_ID;
 
 
 
--TASK 4

CREATE TABLE SERVICEDIM AS SELECT SERVICE_ID, SERVICE_NAME FROM SERVICE;

--SELECT * FROM SERVICEDIM;

CREATE TABLE SERVICECOSTTYPEDIM AS SELECT DISTINCT SERVICE_COST FROM SERVICE;

ALTER TABLE SERVICECOSTTYPEDIM ADD
SERVICE_COST_TYPE VARCHAR (20);

UPDATE SERVICECOSTTYPEDIM
SET SERVICE_COST_TYPE = 'Low Price'
WHERE SERVICE_COST <= 20;
UPDATE SERVICECOSTTYPEDIM
SET SERVICE_COST_TYPE = 'Medium Price'
WHERE SERVICE_COST > 20 AND SERVICE_COST <= 50;
UPDATE SERVICECOSTTYPEDIM
SET SERVICE_COST_TYPE = 'High Price'
WHERE SERVICE_COST >= 50;

SELECT * FROM SERVICECOSTTYPEDIM;


CREATE TABLE HOSPLOCDIM AS SELECT DISTINCT SUBURB, POSTCODE FROM CLINIC;

SELECT * FROM HOSPLOCDIM;


CREATE TABLE AGEGROUPDIM AS SELECT DISTINCT PATIENT_AGE FROM PATIENT;

ALTER TABLE AGEGROUPDIM ADD
AGE_GROUP_ID VARCHAR (20);

UPDATE AGEGROUPDIM
SET AGE_GROUP_ID = 'Infant'
WHERE PATIENT_AGE <= 1;
UPDATE AGEGROUPDIM
SET AGE_GROUP_ID = 'Children'
WHERE PATIENT_AGE > 1 AND PATIENT_AGE < 18;
UPDATE AGEGROUPDIM
SET AGE_GROUP_ID = 'Adult'
WHERE PATIENT_AGE >= 18 AND PATIENT_AGE < 65;
UPDATE AGEGROUPDIM
SET AGE_GROUP_ID = 'Senior'
WHERE PATIENT_AGE >= 65;

SELECT * FROM AGEGROUPDIM ORDER BY PATIENT_AGE;

CREATE TABLE TIMEPERIODDIM AS SELECT DISTINCT to_char(patient_service_start_date, 'MM-YYYY') AS "APPOINTMENT PERIOD" from ASSIGNMENT;

ALTER TABLE TIMEPERIODDIM ADD
TIME_PERIOD_ID VARCHAR(20);

UPDATE TIMEPERIODDIM
SET TIME_PERIOD_ID = 'Summer' 
WHERE "APPOINTMENT PERIOD" IN ('12-2020','01-2020', '02-2020');
UPDATE TIMEPERIODDIM
SET TIME_PERIOD_ID = 'Autumn' 
WHERE "APPOINTMENT PERIOD" IN ('03-2020','04-2020', '05-2020');
UPDATE TIMEPERIODDIM
SET TIME_PERIOD_ID = 'Winter' 
WHERE "APPOINTMENT PERIOD" IN ('06-2020','07-2020', '08-2020');
UPDATE TIMEPERIODDIM
SET TIME_PERIOD_ID = 'Spring' 
WHERE "APPOINTMENT PERIOD" IN ('09-2020','10-2020', '11-2020');

SELECT * FROM TIMEPERIODDIM;


--- THE TEMPORARY FACT TABLE CREATION

CREATE TABLE TEMP_FACT_TF AS SELECT S.SERVICE_ID, S.SERVICE_COST, A.PATIENT_SERVICE_START_DATE, P.PATIENT_AGE, C.SUBURB
FROM SERVICE S, ASSIGNMENT A, PATIENT P, CLINIC C
WHERE S.SERVICE_ID = A.SERVICE_ID AND A.PATIENT_ID = P.PATIENT_ID 
AND S.HOSPITAL_ID = C.HOSPITAL_ID
GROUP BY S.SERVICE_ID, S.SERVICE_COST, A.PATIENT_SERVICE_START_DATE, P.PATIENT_AGE, C.SUBURB;

ALTER TABLE TEMP_FACT_TF ADD
TIME_PERIOD_ID VARCHAR(20);
ALTER TABLE TEMP_FACT_TF ADD
AGE_GROUP_ID VARCHAR(20);
ALTER TABLE TEMP_FACT_TF ADD
SERVICE_COST_TYPE VARCHAR(20);

DESC TEMP_FACT_TF;
SELECT * FROM TEMP_FACT_TF;

UPDATE TEMP_FACT_TF
SET SERVICE_COST_TYPE = 'Low Price'
WHERE SERVICE_COST <= 20;
UPDATE TEMP_FACT_TF
SET SERVICE_COST_TYPE = 'Medium Price'
WHERE SERVICE_COST > 20 AND SERVICE_COST <= 50;
UPDATE TEMP_FACT_TF
SET SERVICE_COST_TYPE = 'High Price'
WHERE SERVICE_COST >= 50;

UPDATE TEMP_FACT_TF
SET AGE_GROUP_ID = 'Infant'
WHERE PATIENT_AGE <= 1;
UPDATE TEMP_FACT_TF
SET AGE_GROUP_ID = 'Children'
WHERE PATIENT_AGE > 1 AND PATIENT_AGE < 18;
UPDATE TEMP_FACT_TF
SET AGE_GROUP_ID = 'Adult'
WHERE PATIENT_AGE >= 18 AND PATIENT_AGE < 65;
UPDATE TEMP_FACT_TF
SET AGE_GROUP_ID = 'Senior'
WHERE PATIENT_AGE >= 65;

SELECT * FROM TEMP_FACT_TF;

UPDATE TEMP_FACT_TF
SET TIME_PERIOD_ID = 'Summer' 
WHERE TO_CHAR(PATIENT_SERVICE_START_DATE,'MM-YYYY') IN ('12-2020','01-2020', '02-2020');
UPDATE TEMP_FACT_TF
SET TIME_PERIOD_ID = 'Autumn' 
WHERE TO_CHAR(PATIENT_SERVICE_START_DATE,'MM-YYYY') IN ('03-2020','04-2020', '05-2020');
UPDATE TEMP_FACT_TF
SET TIME_PERIOD_ID = 'Winter' 
WHERE TO_CHAR(PATIENT_SERVICE_START_DATE,'MM-YYYY') IN ('06-2020','07-2020', '08-2020');
UPDATE TEMP_FACT_TF
SET TIME_PERIOD_ID = 'Spring' 
WHERE TO_CHAR(PATIENT_SERVICE_START_DATE,'MM-YYYY') IN ('09-2020','10-2020', '11-2020');


SELECT * FROM TEMP_FACT_TF;


---THE FACT TABLE


CREATE TABLE GOVTHOSPFACT AS SELECT S.SERVICE_ID AS "SERVICE ID", TF.SERVICE_COST_TYPE AS "SERVICE COST TYPE",
TF.TIME_PERIOD_ID AS "SEASONAL TIME PERIOD", 
TF.AGE_GROUP_ID AS "AGE GROUP", C.SUBURB AS "HOSPITAL LOCATION",
COUNT(A.PATIENT_ID) AS "TOTAL PATIENTS",
SUM(A.ASSIGNMENT_ID * S.SERVICE_COST) AS "TOTAL SERVICE CHARGED" 
FROM SERVICE S, CLINIC C, TEMP_FACT_TF TF, ASSIGNMENT A
WHERE S.HOSPITAL_ID = C.HOSPITAL_ID AND C.SUBURB = TF.SUBURB AND
TF.SERVICE_ID = A.SERVICE_ID 
GROUP BY S.SERVICE_ID, TF.SERVICE_COST_TYPE, TF.TIME_PERIOD_ID, TF.AGE_GROUP_ID, C.SUBURB;

SELECT * FROM GOVTHOSPFACT ORDER BY "SERVICE ID";

--SELECT "SERVICE ID", "TOTAL PATIENTS", "TOTAL SERVICE CHARGED" FROM GOVTHOSPFACT;
--SELECT "SEASONAL TIME PERIOD", "TOTAL PATIENTS", "TOTAL SERVICE CHARGED" FROM GOVTHOSPFACT;
--SELECT "AGE GROUP"", "TOTAL PATIENTS", "TOTAL SERVICE CHARGED" FROM GOVTHOSPFACT;
--SELECT "HOSPITAL LOCATION"", "TOTAL PATIENTS", "TOTAL SERVICE CHARGED" FROM GOVTHOSPFACT;


--TASK 5

--Q1)
SELECT SUM("TOTAL PATIENTS") AS "TOTAL PATIENTS" FROM GOVTHOSPFACT WHERE "SEASONAL TIME PERIOD" = 'Winter';

--Q2)
SELECT SUM("TOTAL SERVICE CHARGED") AS "TOTAL SERVICE CHARGED", "SERVICE COST TYPE" FROM GOVTHOSPFACT GROUP BY "SERVICE COST TYPE";

--Q3)
SELECT "AGE GROUP", SUM("TOTAL PATIENTS") AS "TOTAL PATIENTS"
FROM GOVTHOSPFACT G, TIMEPERIODDIM T WHERE G."SEASONAL TIME PERIOD" = T. TIME_PERIOD_ID
AND "APPOINTMENT PERIOD" = '01-2020' GROUP BY "AGE GROUP";
 
--Q4)
SELECT "HOSPITAL LOCATION", SUM("TOTAL SERVICE CHARGED") AS "TOTAL SERVICE CHARGED" FROM GOVTHOSPFACT G, SERVICEDIM S 
WHERE G."SERVICE ID" = S.SERVICE_ID AND 
SERVICE_NAME = 'GENERAL MEDICAL CONSULTATIONS' GROUP BY "HOSPITAL LOCATION";











  
  
  



  
  
  
